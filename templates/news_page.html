<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSense AI - Latest News Feed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script>
        // Custom Tailwind Configuration (same as index.html)
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-navy': '#051525', // Main Background
                        'card-bg': '#0E1B2C',   // Slightly lighter background for cards/sections
                        'primary-green': '#00CC66', // Bright Green Accent (Positive)
                        'primary-red': '#F87171', // Red 400 (Negative)
                        'primary-orange': '#FFB300', // Vibrant Orange CTA
                        'positive-color': '#00CC66', // Green for Positive
                        'negative-color': '#F87171', // Red for Negative
                        'neutral-color': '#4B5563', // Gray 600 for Neutral
                        'active-blue': '#00BFFF', // Used for active filter buttons
                    },
                }
            }
        }

        // Mock News Article Data (Detailed for the Grid)
        const allArticles = [
            { id: 1, filter: 'Positive Sentiment', topic: 'Tech Buyout', ticker: 'TCS', sentiment: 'Positive', title: '(PR) TCS Unveils Chiplet-Based System Engineering...', summary: 'Tata Consultancy Services, a global leader in IT services, consulting, and business solutions, announced the launch of its Chiplet-based System Engineering Services, designed to help semiconductor companies...'},
            { id: 2, filter: 'Negative Signals', topic: 'Market Trends', ticker: 'INFY', sentiment: 'Negative', title: 'As Infosys Mulls Buyback, Will TCS Follow Suit?', summary: 'Infosys Ltd is set to consider a share buyback proposal. Global brokerage CLSA believes that Tata Consultancy Services Ltd, the country\'s largest I...'},
            { id: 3, filter: 'Positive Sentiment', topic: 'Business News', ticker: 'TCS', sentiment: 'Positive', title: 'TCS launches chiplet-based system engineering servic...', summary: 'Tata Consultancy Services has launched chiplet-based system engineering services to accelerate semiconductor innovation and support India\'s ambition to become a global semiconductor hub.'},
            { id: 4, filter: 'Negative Signals', topic: 'Market Trends', ticker: 'ORCL', sentiment: 'Negative', title: 'Oracle stock dip threatens new high...', summary: 'After a significant rally, Oracle faces profit-taking pressure, causing a small dip that could jeopardize its recent upward trend if momentum is not maintained.'},
            { id: 5, filter: 'Positive Sentiment', topic: 'Tech Buyout', ticker: 'TCS', sentiment: 'Positive', title: 'TCS Chiplet Engineering Services to...', summary: 'The new services help chipmakers design faster and more efficient processors using chiplets—small integrated circuits that serve as building blocks for larger chips...'},
            { id: 6, filter: 'Negative Signals', topic: 'Market Trends', ticker: 'ORCL', sentiment: 'Negative', title: 'Oracle\'s $244 billion single-day rally as big as entire I...', summary: 'Oracle shares surged by 36%, adding $244 billion to its market cap after projecting substantial cloud infrastructure revenue growth, potentially reaching $144 billion by fiscal 2030.'},
            { id: 7, filter: 'Neutral Topics', topic: 'Business News', ticker: 'RELIANCE', sentiment: 'Neutral', title: 'Reliance Plans Massive Green Energy Expansion...', summary: 'Reliance Industries Limited announced plans to invest over $10 billion in renewable energy over the next three years, focusing on solar and green hydrogen technologies.'},
            { id: 8, filter: 'Neutral Topics', topic: 'Market Trends', ticker: 'HDFCBANK', sentiment: 'Neutral', title: 'HDFC Bank Q2 Results Beat Estimates...', summary: 'HDFC Bank reported a strong second quarter, with net profits exceeding analyst expectations, driven by robust loan growth and stable asset quality.'},
        ];

        let activeFilter = 'All Articles'; // Default filter

        window.onload = () => {
            renderArticles(allArticles);
            
            // Setup filter click listeners
            document.querySelectorAll('.filter-item').forEach(item => {
                item.addEventListener('click', function() {
                    const newFilter = this.getAttribute('data-filter');
                    applyFilter(newFilter);
                });
            });
            
            // Set up resize listener for responsive canvas drawing
            window.addEventListener('resize', () => {
                if (activeFilter === 'Quick Stats') {
                    drawPieChart();
                }
            });
        };
        
        function applyFilter(filter) {
            activeFilter = filter;
            
            // Update active state in UI
            document.querySelectorAll('.filter-item').forEach(item => {
                item.classList.remove('bg-active-blue', 'text-dark-navy', 'font-semibold');
                item.classList.add('text-gray-400', 'hover:text-white', 'hover:bg-dark-navy');
            });
            const activeElement = document.querySelector(`[data-filter="${filter}"]`);
            if (activeElement) {
                 activeElement.classList.add('bg-active-blue', 'text-dark-navy', 'font-semibold');
                 activeElement.classList.remove('text-gray-400', 'hover:text-white', 'hover:bg-dark-navy');
            }

            // Show or hide the Quick Stats section
            const quickStatsContainer = document.getElementById('quick-stats-container');
            const articlesGrid = document.getElementById('articles-grid');

            if (filter === 'Quick Stats') {
                articlesGrid.classList.add('hidden');
                quickStatsContainer.classList.remove('hidden');
                
                // Render metrics and chart
                const summary = getAnalysisSummary();
                renderKeyMetrics(summary);
                // Call drawPieChart immediately after showing the container
                setTimeout(drawPieChart, 0); 
            } else {
                articlesGrid.classList.remove('hidden');
                quickStatsContainer.classList.add('hidden');
                
                // Filter and render the articles
                let filteredData = allArticles;
                if (filter === 'Positive Sentiment' || filter === 'Negative Signals' || filter === 'Neutral Topics') {
                    filteredData = allArticles.filter(a => a.filter === filter);
                } else if (filter === 'All Articles') {
                     filteredData = allArticles;
                } 
                renderArticles(filteredData);
            }
        }

        function renderArticles(articles) {
            const container = document.getElementById('articles-grid');
            container.innerHTML = ''; // Clear previous articles

            if (articles.length === 0) {
                 container.innerHTML = '<p class="col-span-1 sm:col-span-2 xl:col-span-3 text-center text-gray-500 py-12">No articles match the current filter criteria.</p>';
                 return;
            }

            articles.forEach(article => {
                const sentiment = article.sentiment;
                const sentimentClass = sentiment === 'Positive' ? 'sentiment-positive' : (sentiment === 'Negative' ? 'sentiment-negative' : 'sentiment-neutral');
                const borderColor = sentiment === 'Positive' ? 'border-primary-green' : (sentiment === 'Negative' ? 'border-primary-red' : 'border-neutral-color');

                const cardHtml = `
                    <div class="card bg-card-bg rounded-xl shadow-lg border-t-4 ${borderColor} p-6 flex flex-col justify-between">
                        <div>
                            <span class="text-xs font-bold uppercase text-gray-500 mb-1 block">${article.ticker} / ${article.topic}</span>
                            <h3 class="text-white font-bold text-lg mb-2 leading-snug">${article.title}</h3>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-3">${article.summary}</p>
                        </div>
                        <div class="flex justify-between items-center pt-2 border-t border-gray-700/50">
                            <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${sentimentClass} uppercase">
                                ${sentiment}
                            </span>
                            <button onclick="readFullArticle(${article.id})" class="text-sm font-medium text-white px-3 py-1.5 rounded-lg bg-active-blue hover:bg-cyan-500 transition duration-150 flex items-center">
                                READ FULL ARTICLE
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }
        
        function readFullArticle(articleId) {
            // Placeholder for opening a full article modal/page
            alertMessage(`Opening full article for ID: ${articleId}`, 'info');
        }

        // --- Core Analysis Functions ---

        function getSentimentCounts() {
            return allArticles.reduce((acc, article) => {
                acc[article.sentiment] = (acc[article.sentiment] || 0) + 1;
                return acc;
            }, {});
        }

        function getAnalysisSummary() {
            const counts = getSentimentCounts();
            const total = allArticles.length;
            
            // 1. Dominant Sentiment
            let dominantSentiment = 'Neutral';
            let maxCount = 0;
            for (const [sentiment, count] of Object.entries(counts)) {
                if (count > maxCount) {
                    maxCount = count;
                    dominantSentiment = sentiment;
                }
            }
            
            // 2. Most Active Ticker
            const tickerCounts = allArticles.reduce((acc, article) => {
                acc[article.ticker] = (acc[article.ticker] || 0) + 1;
                return acc;
            }, {});
            
            let mostActiveTicker = 'N/A';
            let maxTickerCount = 0;
            for (const [ticker, count] of Object.entries(tickerCounts)) {
                if (count > maxTickerCount) {
                    maxTickerCount = count;
                    mostActiveTicker = ticker;
                }
            }

            return {
                total,
                dominantSentiment,
                mostActiveTicker
            };
        }

        // --- Metric Card Rendering ---
        function renderKeyMetrics(summary) {
            const container = document.getElementById('key-metrics-container');
            
            const sentimentColorClass = summary.dominantSentiment === 'Positive' ? 'text-primary-green' : 
                                        summary.dominantSentiment === 'Negative' ? 'text-primary-red' : 
                                        'text-neutral-color';
            
            const sentimentBorderClass = summary.dominantSentiment === 'Positive' ? 'border-primary-green' : 
                                         summary.dominantSentiment === 'Negative' ? 'border-primary-red' : 
                                         'border-neutral-color';


            const metricsHtml = `
                <!-- Total Articles -->
                <div class="p-5 bg-dark-navy/50 rounded-lg border-l-4 border-active-blue shadow-md transition duration-150 hover:shadow-xl">
                    <div class="flex items-center space-x-3">
                        <!-- Icon: File/Document -->
                        <svg class="w-6 h-6 text-active-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <span class="text-sm font-medium text-gray-400">Total Articles Analyzed</span>
                    </div>
                    <p class="text-3xl font-extrabold text-white mt-2">${summary.total}</p>
                </div>

                <!-- Dominant Sentiment -->
                <div class="p-5 bg-dark-navy/50 rounded-lg border-l-4 ${sentimentBorderClass} shadow-md transition duration-150 hover:shadow-xl">
                    <div class="flex items-center space-x-3">
                        <!-- Icon: Smile/Sentiment -->
                        <svg class="w-6 h-6 ${sentimentColorClass}" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <span class="text-sm font-medium text-gray-400">Dominant Sentiment</span>
                    </div>
                    <p class="text-3xl font-extrabold mt-2 ${sentimentColorClass} uppercase">${summary.dominantSentiment}</p>
                </div>
                
                <!-- Most Active Ticker -->
                <div class="p-5 bg-dark-navy/50 rounded-lg border-l-4 border-primary-orange shadow-md transition duration-150 hover:shadow-xl">
                    <div class="flex items-center space-x-3">
                        <!-- Icon: Stock Chart/Trophy -->
                        <svg class="w-6 h-6 text-primary-orange" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                        <span class="text-sm font-medium text-gray-400">Most Active Ticker</span>
                    </div>
                    <p class="text-3xl font-extrabold text-white mt-2">${summary.mostActiveTicker}</p>
                </div>
            `;
            container.innerHTML = metricsHtml;
        }

        // --- Pie Chart Logic (Updated for Responsiveness) ---

        function drawPieChart() {
            const counts = getSentimentCounts();
            const total = Object.values(counts).reduce((a, b) => a + b, 0);

            if (total === 0) return;

            const data = [
                { label: 'Positive', count: counts.Positive || 0, color: '#00CC66' },
                { label: 'Negative', count: counts.Negative || 0, color: '#F87171' },
                { label: 'Neutral', count: counts.Neutral || 0, color: '#4B5563' },
            ].filter(d => d.count > 0); // Only show segments with count > 0

            const canvas = document.getElementById('sentiment-chart');
            const ctx = canvas.getContext('2d');
            
            // Get the parent container's dimensions to make the canvas fit
            const container = canvas.parentElement;
            
            // Determine the maximum size for the chart (limiting by height for better fit on wider screens)
            const parentWidth = container.clientWidth * 0.45; // Use less than 50% for the chart part
            const parentHeight = container.clientHeight;
            
            const size = Math.min(parentWidth, parentHeight);

            // Set the canvas drawing buffer size (important for sharp rendering)
            canvas.width = size;
            canvas.height = size;
            
            const centerX = size / 2;
            const centerY = size / 2;
            const radius = size / 2.5; // Adjusted radius to leave room for percentage labels
            
            ctx.clearRect(0, 0, size, size);

            let currentAngle = 0;

            // Draw the slices
            data.forEach(slice => {
                const sliceAngle = (slice.count / total) * 2 * Math.PI;
                
                ctx.fillStyle = slice.color;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();

                // Draw label text
                const middleAngle = currentAngle + sliceAngle / 2;
                const textX = centerX + radius * 0.7 * Math.cos(middleAngle);
                const textY = centerY + radius * 0.7 * Math.sin(middleAngle);

                // Calculate percentage
                const percentage = ((slice.count / total) * 100).toFixed(0);

                ctx.fillStyle = slice.label === 'Positive' ? '#051525' : '#FFFFFF'; // Dark text for bright green slice
                ctx.font = '14px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (percentage > 5) { // Only display percentage if the slice is large enough
                    ctx.fillText(`${percentage}%`, textX, textY);
                }

                currentAngle += sliceAngle;
            });

            // Draw Legend
            const legendContainer = document.getElementById('chart-legend');
            legendContainer.innerHTML = data.map(slice => {
                const percentage = ((slice.count / total) * 100).toFixed(1);
                return `
                    <div class="flex items-center space-x-2 text-sm">
                        <span style="background-color: ${slice.color}" class="w-3 h-3 rounded-full"></span>
                        <span class="text-gray-300">${slice.label}:</span>
                        <span class="font-bold text-white">${slice.count} Articles (${percentage}%)</span>
                    </div>
                `;
            }).join('');
        }

        // Mock Alert function instead of alert()
        function alertMessage(message, type) {
            const container = document.getElementById('alert-container');
            const color = type === 'success' ? 'bg-primary-green' : (type === 'info' ? 'bg-primary-orange' : 'bg-primary-red');
            const alertDiv = document.createElement('div');
            alertDiv.className = `p-4 rounded-lg shadow-xl text-dark-navy font-semibold text-sm ${color} mb-3 transition-opacity duration-300`;
            alertDiv.textContent = message;
            
            container.innerHTML = ''; // Clear previous message
            container.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
    </script>
    <style>
        /* Ensures the viewport is fully utilized */
        html, body {
            height: 100%;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #051525;
            min-height: 100vh; /* Use min-height for content stretching */
        }
        .card {
            /* Add subtle 3D lift on hover */
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.7);
        }
        /* Custom styles for sentiment tags */
        .sentiment-positive {
            background-color: rgba(0, 204, 102, 0.2);
            color: #00CC66;
        }
        .sentiment-negative {
            background-color: rgba(248, 113, 113, 0.2);
            color: #F87171;
        }
        .sentiment-neutral {
            background-color: rgba(75, 85, 99, 0.2);
            color: #4B5563;
        }
        /* Custom sidebar item style */
        .filter-item {
            display: block;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.15s;
            cursor: pointer;
        }
        /* Utility for limiting lines of text */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        /* Make canvas fill its container size (CSS size) but its actual drawing size is set by JS */
        #sentiment-chart {
            max-width: 100%;
            height: auto;
            /* Ensures canvas takes its space but remains flexible */
            display: block;
        }
    </style>
</head>
<body class="bg-dark-navy text-gray-200">

    <!-- Navbar -->
    <header class="bg-card-bg shadow-lg sticky top-0 z-10 border-b border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-primary-green">StockSense AI - News Feed</h1>
            <div class="flex items-center space-x-4">
                <!-- Avatar -->
                <div class="w-8 h-8 rounded-full bg-primary-green flex items-center justify-center text-dark-navy font-semibold text-sm cursor-pointer border-2 border-primary-green">J</div>
            </div>
        </div>
    </header>
    
    <!-- Main Content Area: Sidebar + Grid -->
    <!-- Removed fixed height and let content flow, but maintained max-width for visual balance -->
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 grid grid-cols-1 lg:grid-cols-4 gap-8">

        <!-- Sidebar Navigation -->
        <aside class="lg:col-span-1 space-y-8">
            <p class="text-sm text-gray-400">Analysis for 2025-09-11</p>

            <!-- Latest News Section -->
            <div class="bg-card-bg rounded-xl p-4 shadow-lg border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-2 pb-2 border-b border-gray-700/50">Latest News</h3>
                <div class="space-y-1">
                    <!-- Default active filter -->
                    <button data-filter="All Articles" class="filter-item text-dark-navy bg-active-blue font-semibold w-full text-left">
                        All Articles
                    </button>
                    <button data-filter="Quick Stats" class="filter-item text-gray-400 hover:text-white hover:bg-dark-navy w-full text-left">
                        Quick Stats
                    </button>
                </div>
            </div>

            <!-- AI Powered Market Insights Section -->
            <div class="bg-card-bg rounded-xl p-4 shadow-lg border border-gray-800">
                <h3 class="text-lg font-bold text-white mb-2 pb-2 border-b border-gray-700/50">AI Powered Market Insights</h3>
                <div class="space-y-1">
                    <button data-filter="Positive Sentiment" class="filter-item text-gray-400 hover:text-primary-green hover:bg-dark-navy w-full text-left flex items-center">
                        <span class="text-primary-green mr-2">●</span> Positive Sentiment
                    </button>
                    <button data-filter="Neutral Topics" class="filter-item text-gray-400 hover:text-white hover:bg-dark-navy w-full text-left flex items-center">
                        <span class="text-gray-400 mr-2">●</span> Neutral Topics
                    </button>
                    <button data-filter="Negative Signals" class="filter-item text-gray-400 hover:text-primary-red hover:bg-dark-navy w-full text-left flex items-center">
                        <span class="text-primary-red mr-2">●</span> Negative Signals
                    </button>
                </div>
            </div>
            
            <!-- Alert container for messages -->
            <div id="alert-container"></div>
        </aside>
        
        <!-- Articles Grid (Default View) -->
        <main class="lg:col-span-3">
            <div id="articles-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                <!-- Articles will be rendered here by JavaScript -->
            </div>

            <!-- Quick Stats View (Hidden by default) -->
            <div id="quick-stats-container" class="hidden">
                <h2 class="text-3xl font-extrabold text-white mb-6 border-b pb-4 border-gray-700">Overall News Sentiment Analysis</h2>
                
                <div class="grid grid-cols-1 gap-6">
                    <!-- Key Metrics Grid Card -->
                    <div class="bg-card-bg rounded-xl p-6 shadow-xl border border-gray-800">
                        <h3 class="text-xl font-semibold text-white mb-4 border-b pb-3 border-gray-700/50">Key Metrics Overview</h3>
                        <div id="key-metrics-container" class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <!-- Metric cards will be rendered here by renderKeyMetrics() -->
                        </div>
                    </div>

                    <!-- Chart Card -->
                    <div class="bg-card-bg rounded-xl p-6 shadow-xl border border-gray-800">
                        <h3 class="text-xl font-semibold text-white mb-4">Sentiment Distribution</h3>
                        <!-- Added h-96 class to give the flex container a fixed height for better mobile/tablet rendering -->
                        <div class="flex flex-col md:flex-row items-center justify-around h-96">
                            <!-- Canvas now uses no fixed width/height attributes, allowing JS to set drawing size based on container -->
                            <canvas id="sentiment-chart"></canvas> 
                            <div id="chart-legend" class="p-4 space-y-3 md:pl-8">
                                <!-- Legend will be rendered here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
</body>
</html>