<!DOCTYPE html>
<html lang="en" class="h-full bg-dark-navy">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StockSense Analytics Dashboard | TCGI</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script>
        // Custom Tailwind Configuration for the dark theme and colors
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-navy': '#051525',     // Main Background
                        'card-bg': '#0E1B2C',       // Card Background
                        'primary-green': '#00CC66', // Positive Accent
                        'primary-red': '#F87171',   // Negative Accent
                        'primary-orange': '#FFB300', // Warning/Neutral CTA
                        'positive-color': '#00CC66',
                        'negative-color': '#F87171',
                        'neutral-color': '#4B5563', 
                        'active-blue': '#00BFFF',   // Active Tab/Highlight
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Ensures the canvas takes up the max space within its flexible container */
        #sentiment-chart {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }

        /* Styling for the tab buttons */
        .tab-btn {
            @apply px-4 py-2 font-semibold text-sm rounded-t-lg transition-colors duration-200 border-b-2 border-transparent text-gray-400 hover:text-white;
        }

        .tab-btn.active {
            @apply border-active-blue text-white bg-gray-700/50;
        }
        
        .dashboard-card {
            @apply transition-all duration-300 transform hover:scale-[1.005] hover:shadow-active-blue/50 hover:shadow-xl;
        }

        /* Adjust chart container size for the new layout */
        .chart-visual-container {
            height: 380px; /* Fixed height for visual stability */
        }
        
        @media (min-width: 768px) {
            .chart-visual-container {
                display: flex;
                flex-direction: row;
                align-items: center;
                justify-content: space-around;
            }
        }
    </style>
</head>

<body class="min-h-screen antialiased text-gray-100 font-sans bg-dark-navy">
    <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 space-y-12">
        
        <!-- HEADER -->
        <header class="mb-4">
            <div class="border-b pb-4 border-gray-700">
                <h1 class="text-3xl sm:text-4xl font-extrabold text-white tracking-tight">
                    <i class="fas fa-chart-line text-primary-green mr-2"></i> StockSense Intelligence Report
                </h1>
                <p class="mt-2 text-xl font-medium text-gray-400" id="header-company-ticker"></p>
            </div>
        </header>

        <!-- MAIN LAYOUT: FULL WIDTH STACKED SECTIONS -->
        <main class="space-y-12">

            <!-- 1. KEY INDICATORS (Full Width Metric Bar) -->
            <section id="key-metrics-section" class="space-y-4">
                <h2 class="text-2xl font-bold text-primary-orange border-l-4 border-primary-orange pl-3">
                    1. Core Financial and Sector Indicators
                </h2>
                <div id="key-metrics-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
                    <!-- Metric Cards will be rendered here -->
                </div>
            </section>
            
            <!-- 2. SENTIMENT VISUALIZATION (Chart + Legend) -->
            <section id="sentiment-analysis-section" class="space-y-4">
                <h2 class="text-2xl font-bold text-primary-green border-l-4 border-primary-green pl-3">
                    2. Market Sentiment Distribution
                </h2>
                <!-- Sentiment Chart Card (Flexible display) -->
                <div class="bg-card-bg rounded-xl p-6 shadow-2xl border border-gray-800 dashboard-card chart-visual-container flex-col md:flex-row">
                    
                    <div class="w-full md:w-1/2 flex justify-center items-center h-full max-h-72 mb-6 md:mb-0">
                        <canvas id="sentiment-chart"></canvas> 
                    </div>
                    
                    <div class="w-full md:w-1/2 p-2 md:pl-8 space-y-4">
                        <h3 class="text-xl font-bold text-white mb-2 border-b border-gray-700 pb-2">Net Score & Legend</h3>
                        <div id="net-score-display" class="mb-4">
                            <!-- Net Score will be injected here -->
                        </div>
                        <div id="chart-legend" class="space-y-3">
                            <!-- Legend will be rendered here -->
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 3. COMPANY & SECTOR SUMMARY -->
            <section id="summary-section" class="space-y-4">
                <h2 class="text-2xl font-bold text-primary-orange border-l-4 border-primary-orange pl-3">
                    3. Company Profile and Sector Context
                </h2>
                <div class="bg-card-bg rounded-xl p-6 shadow-2xl border border-gray-800 dashboard-card">
                    <p class="text-gray-300 text-base leading-relaxed" id="domain-summary-text"></p>
                </div>
            </section>
            
            <!-- 4. CORRELATIONS (Tabbed View Full Width) -->
            <section id="correlations-section" class="space-y-4">
                <h2 class="text-2xl font-bold text-active-blue border-l-4 border-active-blue pl-3">
                    4. Peer & Competitor Correlations (1-Year)
                </h2>
                
                <div class="bg-card-bg rounded-xl shadow-2xl border border-gray-800 dashboard-card">
                    
                    <!-- Tab Navigation -->
                    <div id="filter-tabs" class="flex flex-wrap border-b border-gray-700/70 px-4 pt-2">
                        <button data-filter="all" class="tab-btn active">All Relationships</button>
                        <button data-filter="sector-peers" class="tab-btn">Sector Peers</button>
                        <button data-filter="competitors" class="tab-btn">Key Competitors</button>
                        <button data-filter="strong" class="tab-btn">High Correlation (>0.6)</button>
                    </div>

                    <!-- Correlation Table Container -->
                    <div class="p-4 sm:p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-700">
                                <thead class="bg-gray-700/50">
                                    <tr>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-300 rounded-tl-lg">
                                            Company
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-300">
                                            Correlation
                                        </th>
                                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-300 rounded-tr-lg">
                                            Strength
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="correlation-table-body" class="divide-y divide-gray-800">
                                    <!-- Correlation rows will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
            
        </main>
    </div>

    <script>
        // --- MOCK DATA ---
        const MOCK_DATA = {
            companyName: "TechCorp Global Inc.",
            ticker: "TCGI",
            domainMetrics: [
                { label: "Sector", value: "Technology", icon: "fas fa-microchip", color: 'text-primary-orange' },
                { label: "Market Cap", value: "950B USD", icon: "fas fa-money-bill-wave", color: 'text-active-blue' },
                { label: "P/E Ratio", value: "45.2x", icon: "fas fa-chart-bar", color: 'text-primary-orange' },
                { label: "Beta (5Y)", value: "1.25", icon: "fas fa-signal", color: 'text-primary-red' },
                { label: "Dividend Yield", value: "0.5%", icon: "fas fa-hand-holding-usd", color: 'text-primary-green' },
                { label: "Total Revenue", value: "$88B", icon: "fas fa-dollar-sign", color: 'text-primary-green' },
            ],
            domainSummary: "TechCorp Global operates in the highly competitive Cloud Computing sector, characterized by rapid innovation and high growth potential. Its elevated P/E ratio and Beta suggest strong market expectations and higher volatility compared to the S&P 500 average. The company maintains a dominant position in enterprise cloud infrastructure. Recent performance indicates a market shift towards infrastructure services, benefiting TCGI's core offerings.",
            sentimentData: [
                { label: "Positive", value: 65, color: '#00CC66', score: '+0.45' }, 
                { label: "Neutral", value: 25, color: '#4B5563', score: '0.00' }, 
                { label: "Negative", value: 10, color: '#F87171', score: '-0.25' }  
            ],
            correlations: [
                { ticker: "MSFT", name: "MegaSoft Corp", correlation: 0.85, relationship: "sector-peers", strength: "very-strong-positive" },
                { ticker: "GOOGL", name: "Alphabet Inc.", correlation: 0.62, relationship: "sector-peers", strength: "strong-positive" },
                { ticker: "AMZN", name: "Retail Giant", correlation: 0.35, relationship: "sector-peers", strength: "moderate-positive" },
                { ticker: "ORCL", name: "Oracle Systems", correlation: 0.21, relationship: "competitors", strength: "weak-positive" },
                { ticker: "IBM", name: "Big Blue Corp", correlation: -0.15, relationship: "sector-peers", strength: "weak-negative" },
                { ticker: "TSLA", name: "Electro Motors", correlation: -0.48, relationship: "competitors", strength: "moderate-negative" },
                { ticker: "V", name: "Vanguard Payment", correlation: 0.95, relationship: "strong", strength: "very-strong-positive" }
            ]
        };

        // --- GENERAL HELPERS ---

        /**
         * Generates a colored badge/pill for correlation strength.
         */
        function getStrengthBadge(strength) {
            const s = strength.toLowerCase().replace(/-/g, '_');
            let colorClass, icon;
            let displayText = strength.replace(/-/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');

            if (s.includes('very_strong') || s.includes('strong')) {
                colorClass = s.includes('positive') ? 'bg-positive-color/20 text-positive-color' : 'bg-primary-red/20 text-primary-red';
                icon = s.includes('positive') ? 'fa-arrow-up' : 'fa-arrow-down';
            } else if (s.includes('moderate')) {
                colorClass = 'bg-primary-orange/20 text-primary-orange';
                icon = 'fa-arrows-left-right';
            } else { // weak, neutral
                colorClass = 'bg-gray-600/30 text-gray-400';
                icon = 'fa-minus';
            }
            
            displayText = displayText.replace('Very Strong', 'V. Strong').replace('Moderate', 'Mod.');

            return `
                <span class="inline-flex items-center px-2 py-0.5 rounded-md text-[11px] font-semibold ${colorClass} whitespace-nowrap">
                    <i class="fas ${icon} mr-1 text-[8px]"></i>
                    ${displayText}
                </span>`;
        }

        // --- SECTION 1 & 3: INFO AND METRICS RENDERING ---

        function renderHeader() {
            document.getElementById('header-company-ticker').textContent = `${MOCK_DATA.companyName} (${MOCK_DATA.ticker})`;
            document.getElementById('domain-summary-text').textContent = MOCK_DATA.domainSummary;
        }

        function renderKeyMetrics() {
            const container = document.getElementById('key-metrics-container');
            container.innerHTML = '';
            
            MOCK_DATA.domainMetrics.forEach(metric => {
                const card = `
                    <div class="bg-gray-800/50 rounded-lg p-4 shadow-md border border-gray-700 hover:border-active-blue transition duration-300">
                        <div class="flex items-center space-x-3">
                            <i class="${metric.icon} text-lg ${metric.color}"></i>
                            <div>
                                <p class="text-xs font-light text-gray-400 uppercase tracking-wider">${metric.label}</p>
                                <p class="text-xl font-semibold text-white truncate">${metric.value}</p>
                            </div>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', card);
            });
        }


        // --- SECTION 2: SENTIMENT ANALYSIS (DONUT CHART) ---

        /**
         * Draws a responsive Donut Chart on the canvas.
         */
        function drawSentimentChart() {
            const canvas = document.getElementById('sentiment-chart');
            const ctx = canvas.getContext('2d');
            const data = MOCK_DATA.sentimentData;
            const legendContainer = document.getElementById('chart-legend');
            const netScoreDisplay = document.getElementById('net-score-display');
            
            // Find the main score for the center text
            const positiveData = data.find(item => item.label === 'Positive');
            const netSentiment = positiveData ? positiveData.score : '+0.00'; 
            const netColor = netSentiment.startsWith('+') ? 'text-primary-green' : (netSentiment.startsWith('-') ? 'text-primary-red' : 'text-white');

            // Render Net Score Display
            netScoreDisplay.innerHTML = `
                <div class="flex items-end justify-start md:justify-center lg:justify-start space-x-2">
                    <span class="text-5xl font-extrabold ${netColor}">${netSentiment}</span>
                    <span class="text-lg text-gray-400">Net Score</span>
                </div>
                <p class="text-sm text-gray-500 mt-1">Based on ${positiveData.value}% Positive sentiment.</p>
            `;
            
            // Setup Canvas Dimensions
            // Calculate size based on the smaller of the container's width (max 300px) or height (max 288px)
            const parent = canvas.parentElement;
            const size = Math.min(parent.clientWidth * 0.8, 280); 
            canvas.width = size;
            canvas.height = size;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const outerRadius = (size / 2) * 0.9; 
            const innerRadius = outerRadius * 0.6; 
            const animationSpeed = 0.05;

            // Main Drawing Loop (Recursive Animation)
            const targetTotalAngle = Math.PI * 2; 

            function draw(animationProgress = 1) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let startAngle = 0;
                const totalValue = data.reduce((sum, item) => sum + item.value, 0);

                data.forEach((item) => {
                    const sliceAngle = (item.value / totalValue) * targetTotalAngle * animationProgress;
                    const endAngle = startAngle + sliceAngle;

                    // Draw the arc
                    ctx.beginPath();
                    ctx.fillStyle = item.color;
                    ctx.arc(centerX, centerY, outerRadius, startAngle, endAngle);
                    ctx.arc(centerX, centerY, innerRadius, endAngle, startAngle, true);
                    ctx.closePath();
                    ctx.fill();

                    // Calculate position for the label (mid-point of the slice)
                    const midAngle = startAngle + sliceAngle / 2;
                    const labelDistance = innerRadius + (outerRadius - innerRadius) / 2;
                    const labelX = centerX + labelDistance * Math.cos(midAngle);
                    const labelY = centerY + labelDistance * Math.sin(midAngle);
                    
                    // Draw the label
                    if (item.value > 5) { 
                        ctx.fillStyle = 'white';
                        ctx.font = '12px Inter, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(`${item.value}%`, labelX, labelY);
                    }

                    startAngle = endAngle;
                });
            }
            
            // Simple animation loop
            let progress = 0;
            function animate() {
                if (progress < 1) {
                    progress += animationSpeed;
                    if (progress > 1) progress = 1;
                    draw(progress);
                    requestAnimationFrame(animate);
                } else {
                    draw(1);
                }
            }
            animate();
            
            // Render Legend
            legendContainer.innerHTML = '';
            data.forEach(item => {
                const legendItem = `
                    <div class="flex items-center justify-between text-white text-base">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 rounded-full" style="background-color: ${item.color}; border: 1px solid #333;"></div>
                            <span class="font-light">${item.label} Sentiment</span>
                        </div>
                        <span class="font-bold">${item.value}%</span>
                    </div>
                `;
                legendContainer.insertAdjacentHTML('beforeend', legendItem);
            });
        }
        
        // --- SECTION 4: CORRELATIONS (TABBED) RENDERING & INTERACTION ---

        function renderCorrelationTable(data = MOCK_DATA.correlations, filter = 'all') {
            const tbody = document.getElementById('correlation-table-body');
            tbody.innerHTML = '';

            let filteredData = data;
            
            // Apply filtering based on active tab
            if (filter !== 'all') {
                filteredData = data.filter(item => {
                    if (filter === 'strong') {
                        // Strong is defined as absolute correlation >= 0.6
                        return Math.abs(item.correlation) >= 0.6;
                    }
                    return item.relationship === filter;
                });
            }

            if (filteredData.length === 0) {
                 tbody.innerHTML = `<tr><td colspan="3" class="text-center py-6 text-gray-500">No relationships found for this category.</td></tr>`;
                 return;
            }

            // Sort data by absolute correlation strength (descending)
            filteredData.sort((a, b) => Math.abs(b.correlation) - Math.abs(a.correlation));


            filteredData.forEach(item => {
                const sign = item.correlation > 0 ? '+' : '';
                const strengthBadge = getStrengthBadge(item.strength);
                // Use a color scale for the correlation number
                const corrAbs = Math.abs(item.correlation);
                let textColor;
                if (corrAbs >= 0.7) { textColor = item.correlation > 0 ? 'text-primary-green' : 'text-primary-red'; }
                else if (corrAbs >= 0.4) { textColor = item.correlation > 0 ? 'text-green-400' : 'text-red-400'; }
                else { textColor = 'text-gray-300'; }


                const row = `
                    <tr class="transition duration-150 hover:bg-gray-800/70">
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="font-medium text-white text-base">${item.name}</div>
                            <div class="text-xs text-gray-400">${item.ticker}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-lg ${textColor} font-bold">
                            ${sign}${item.correlation.toFixed(2)}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm">
                            ${strengthBadge}
                        </td>
                    </tr>
                `;
                tbody.insertAdjacentHTML('beforeend', row);
            });
        }

        function setupCorrelationTabs() {
            const tabs = document.querySelectorAll('.tab-btn');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function(event) {
                    const filter = event.target.dataset.filter;
                    
                    // 1. Update active tab styles
                    tabs.forEach(btn => {
                        btn.classList.remove('active');
                    });
                    event.target.classList.add('active');

                    // 2. Re-render table with new filter
                    renderCorrelationTable(MOCK_DATA.correlations, filter);
                });
            });
        }


        // --- INITIALIZATION ---
        
        window.onload = function() {
            // 1. Header and Summary
            renderHeader();
            
            // 2. Key Metrics (Full Width)
            renderKeyMetrics();

            // 3. Sentiment Analysis
            drawSentimentChart(); 
            
            // 4. Correlations
            // Render default view (All)
            renderCorrelationTable(MOCK_DATA.correlations, 'all'); 
            setupCorrelationTabs();

            // Redraw chart on window resize to maintain responsiveness
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                // Ensure chart redraws when containers potentially change size on resize
                resizeTimeout = setTimeout(drawSentimentChart, 100);
            });
        };

    </script>
</body>
</html>